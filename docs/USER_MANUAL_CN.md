# Reachy Mini 语音助手 - 用户手册

## 系统要求

### 硬件
- Reachy Mini 机器人（带 ReSpeaker XVF3800 麦克风）
- 网络连接（WiFi 或有线）

### 软件
- Home Assistant（2024.1 或更高版本）
- Home Assistant 中已启用 ESPHome 集成

---

## 安装步骤

### 第一步：安装应用
从 Reachy Mini 应用商店安装 `reachy_mini_ha_voice`。

### 第二步：启动应用
应用将自动：
- 在端口 6053 启动 ESPHome 服务器
- 下载所需的唤醒词模型和音效文件
- 通过 mDNS 注册以便自动发现

### 第三步：连接 Home Assistant
**自动连接（推荐）：**
Home Assistant 会通过 mDNS 自动发现 Reachy Mini。

**手动连接：**
1. 进入 设置 → 设备与服务
2. 点击"添加集成"
3. 选择"ESPHome"
4. 输入机器人的 IP 地址和端口 6053

---

## 功能介绍

### 语音助手
| 功能 | 说明 |
|------|------|
| 唤醒词 | 说 "Okay Nabu" 激活（可配置） |
| 停止词 | 说 "Stop" 结束对话 |
| 连续对话模式 | 无需重复唤醒词即可持续对话 |
| 语音识别/合成 | 使用 Home Assistant 的语音引擎 |

**支持的唤醒词：**
- Okay Nabu（默认）
- Hey Jarvis
- Alexa
- Hey Luna

### 运动控制
| 功能 | 说明 |
|------|------|
| 头部控制 | 俯仰、横滚、偏航角度（±40°） |
| 身体旋转 | 偏航角度（±160°） |
| 天线控制 | 左/右角度（±90°） |
| 预设动作 | 点头、摇头、环顾四周 |

### 人脸追踪
| 功能 | 说明 |
|------|------|
| 检测 | 基于 YOLO 的人脸检测 |
| 追踪 | 头部跟随检测到的人脸 |
| 身体跟随 | 头部转动时身体随之旋转 |
| 自适应帧率 | 活跃时 15fps，空闲时 2fps |

### 手势检测
| 手势 | 响应 |
|------|------|
| 竖起大拇指 👍 | 开心动画 |
| 大拇指朝下 👎 | 难过动画 |
| 挥手 👋 | 挥手回应 |
| OK 手势 👌 | 确认点头 |
| 手掌 ✋ | 停止手势 |

### 情绪响应
机器人自动检测对话中的情绪并做出响应：
- 头部动作（点头、倾斜、摇头）
- 天线动画
- 识别 280+ 情绪关键词

### 音频功能
| 功能 | 说明 |
|------|------|
| 扬声器音量 | 0-100% 可调 |
| AGC | 自动增益控制（0-40dB） |
| 噪声抑制 | 0-100% 可调 |
| 回声消除 | 内置 AEC |
| Sendspin | 多房间音频支持 |

### 摄像头
| 功能 | 说明 |
|------|------|
| 直播流 | 用于 Home Assistant 的 MJPEG 流 |
| 分辨率 | 可配置 |
| 隐私保护 | 仅本地处理，不上传云端 |

---

## Home Assistant 实体

### 控制实体（可读写）
| 实体 | 类型 | 范围 |
|------|------|------|
| 扬声器音量 | 数值 | 0-100% |
| 电机开关 | 开关 | 开/关 |
| 电机模式 | 选择 | 启用/禁用/重力补偿 |
| 人脸追踪 | 开关 | 开/关 |
| 手势检测 | 开关 | 开/关 |
| DOA 追踪 | 开关 | 开/关 |
| 连续对话 | 开关 | 开/关 |
| 头部俯仰/横滚/偏航 | 数值 | ±40° |
| 身体偏航 | 数值 | ±160° |
| 左/右天线 | 数值 | ±90° |
| AGC 最大增益 | 数值 | 0-40dB |
| 噪声抑制 | 数值 | 0-100% |

### 动作按钮
| 按钮 | 动作 |
|------|------|
| 唤醒 | 从睡眠中唤醒机器人 |
| 睡眠 | 使机器人进入睡眠 |
| 点头 | 播放点头动画 |
| 摇头 | 播放摇头动画 |
| 环顾 | 播放环顾动画 |

### 传感器（只读）
| 传感器 | 说明 |
|--------|------|
| 守护进程状态 | 机器人守护进程状态 |
| 当前情绪 | 检测到的情绪 |
| 检测到的手势 | 当前手势 |
| DOA 角度 | 声源方向 |
| 语音状态 | 语音助手状态 |
| CPU/内存/磁盘 | 系统诊断信息 |

---

## 睡眠模式

### 进入睡眠
- 在 Home Assistant 中按"睡眠"按钮
- 机器人放松电机、停止摄像头、暂停语音检测

### 唤醒
- 在 Home Assistant 中按"唤醒"按钮
- 或说唤醒词
- 机器人恢复所有功能

---

## 故障排除

| 问题 | 解决方案 |
|------|----------|
| 不响应唤醒词 | 检查 AGC 最大增益，减少背景噪音 |
| 人脸追踪不工作 | 确保光线充足，启用人脸追踪开关 |
| 没有音频输出 | 检查扬声器音量，验证 HA 中的 TTS 引擎 |
| 无法连接 HA | 确认在同一网络，检查端口 6053 |
| 动作卡顿 | 检查电机状态，尝试切换电机开关 |

---

## 快速参考

```
唤醒词：       "Okay Nabu"
停止词：       "Stop"
端口：         6053 (ESPHome)
摄像头端口：   8081 (MJPEG)
```

---

*Reachy Mini 语音助手 v0.9.5*
